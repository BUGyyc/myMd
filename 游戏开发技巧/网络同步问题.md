
# 前言
在进行多人游戏开发过程中，我们期望游戏在不同设备上保持一致的表现，或者说是结果一致，在许多动作类游戏，多人游戏的要求就更高，我们不希望不同客户端看到的结果是不一样的，
这要求我们要保证物理计算的一致，包括随机数，
以及预测式输入，我们不希望长时间等待服务器响应，当然我们在网络波动延迟较大的情况下，可以做出相应的提示，让玩家感知到当前网络较差，

- 插值处理
线性的插值，在单纯的直线运动，我们可以直接采取，k*x+b = y的方式，得到中间值(x,y)。在update中去lerp
- 光滑曲线的插值计算
- 三次样条插值，填补掉帧或延迟造成坐标跳跃，所以我们希望计算中间值，确定平滑曲线，得到最终的路径点
- 定点数计算
设备浮点数计算是有误差的，所以必要时候舍弃设备自带的四舍五入方式，采取手写确定，保持计算一致
客户端，有时候喜欢随机值单独计算，例如，玩家攻击的是否暴击，随机种子保证随机序列，只要保证，随机执行的顺序


---

# Unet
Unity官方提供了NetworkManager的方式
如下运行结果：左边操作，右边同步更新

git

https://github.com/BUGyyc/SyncProject

---

# 网络传输协议的选择

- TCP
TCP可靠，有序，有丢包重传
- UDP
速度快，不可靠，不保证有序，不重传

- KCP

---

# 插值与补偿

- 线性插值
直线式的补偿，可以满足要求不高的同步游戏，线性插值其实是取当前点与网络目标点，得到线段，并且得到线段的线性函数，k*x+b = y 。根据帧数差和实际需求，我们确定一个系数，系数的取值范围是[0,1]，系数为0是当前点，系数为1是目标点。通常可以放在update中，或者协程中

- 三次样条插值


---

# 浮点数计算

浮点计算因为设备硬件差异，会有计算误差，所以必要时候，需要定点计算，提供一个定点计算数学库

之前的站桩英雄，标枪转角就是按照每帧改变速度来实现，标枪的抛物线运动效果，首先确定一个帧率，保证低配手机的帧率和其他手机一致

基本30-40帧就足够了，其次速度改变是有计算过程的，这个过程可能有计算误差，源头就是设备差异，浮点计算结果不一致，那么单独写一个向量计算的定点数实现方法就可以基本忽略这个问题了

https://gameinstitute.qq.com/community/detail/122467

# 其他

https://blog.codingnow.com/2006/04/sync.html

https://zhuanlan.zhihu.com/p/28617637

https://zhuanlan.zhihu.com/p/44341238

https://zhuanlan.zhihu.com/p/49482294

http://gad.qq.com/program/translateview/7168875

https://zhuanlan.zhihu.com/p/49483467

https://zhuanlan.zhihu.com/p/49483875


https://zhuanlan.zhihu.com/p/50440945