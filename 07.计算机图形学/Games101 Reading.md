# 渲染管线综述

传统光栅渲染管线总共分为三个阶段，应用阶段、几何阶段、光栅阶段。


## 几何阶段

CPU 向 GPU发起渲染命令，其他包括需要提交的渲染数据，例如：贴图、Mesh 等，通过系统总线，从硬盘中读取到内存，然后从内存提交到GPU显存。

CPU 向 GPU 发起的渲染命令也被称作 DrawCall。

此外也可以知道，DrawCall 是有代价的。所以我们往往希望合并，或者减少不必要的渲染。

### 如何减少DrawCall ？

- 从源头上减少，例如我们通过遮挡剔除，把不需要渲染的内容，在应用阶段之前就剔除
- 合并：我们通过合批来减少，这样可以减少渲染状态的改变次数。

合批的方式有：静态合批、动态合批

另外还有GPU Instance 也可以减少渲染状态的改变 --

#### 静态合批

静态合批要求对象是静态的，也就是说运行时不可移动、缩放、显隐变换。通常情况下，只有游戏中的静态物体满足条件。

虽然这样可以合批，但是过度的静态合批，也是没用的，甚至会起到反作用，即使原本的目的是为了优化。

缺点如下：

- 占用一定量的显存

#### 动态合批

动态合批，不适合 SkinMeshRender，另外，要求对象顶点数不能过多。



## 几何阶段

通过上一阶段的处理，数据和命令总算到达了 GPU，GPU会根据提供的数据和命令，经历如下几个阶段

- 顶点着色器
- 几何着色器
- 曲面细分
- 裁剪
- 屏幕映射

## 光栅化阶段

通过了几何阶段的处理，渲染的对象从3D空间映射到了2D屏幕空间。然后经历如下阶段：

- 三角形设置
- 三角形遍历
- 像素着色器
- 测试
- 混合



# 光线追踪






# 全局光照